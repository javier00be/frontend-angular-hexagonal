<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Dashboard Administrativo</h1>
        <p class="subtitle">Resumen general del sistema</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="dashboardState.isLoading()" class="loading-container">
        <p-progressSpinner></p-progressSpinner>
        <p>Cargando datos del dashboard...</p>
    </div>

    <!-- Error State -->
    <p-message *ngIf="dashboardState.error()" severity="error" [text]="dashboardState.error()!"
        styleClass="dashboard-error"></p-message>

    <!-- Dashboard Content -->
    <div *ngIf="!dashboardState.isLoading() && dashboardState.hasData()" class="dashboard-content">

        <!-- Stats Cards Grid -->
        <div class="stats-grid">
            <app-stats-card title="Ventas Totales" [value]="dashboardState.totalSalesFormatted()" icon="pi pi-dollar"
                [trend]="12.5" colorClass="blue"></app-stats-card>

            <app-stats-card title="Órdenes" [value]="dashboardState.stats()?.totalOrders || 0"
                icon="pi pi-shopping-cart" [trend]="8.2" colorClass="green"></app-stats-card>

            <app-stats-card title="Productos" [value]="dashboardState.stats()?.totalProducts || 0" icon="pi pi-box"
                [trend]="5.1" colorClass="orange"></app-stats-card>

            <app-stats-card title="Clientes" [value]="dashboardState.stats()?.totalCustomers || 0" icon="pi pi-users"
                [trend]="15.3" colorClass="purple"></app-stats-card>
        </div>

        <!-- Recent Orders Section -->
        <div class="section-container">
            <p-card>
                <ng-template pTemplate="header">
                    <div class="section-header">
                        <h2>
                            <i class="pi pi-list"></i>
                            Órdenes Recientes
                        </h2>
                    </div>
                </ng-template>

                <div class="orders-table">
                    <div class="table-header">
                        <div class="col-id">ID</div>
                        <div class="col-customer">Cliente</div>
                        <div class="col-date">Fecha</div>
                        <div class="col-total">Total</div>
                        <div class="col-status">Estado</div>
                    </div>

                    <div class="table-body">
                        <div *ngFor="let order of dashboardState.stats()?.recentOrders" class="table-row">
                            <div class="col-id">{{ order.id }}</div>
                            <div class="col-customer">{{ order.customerName }}</div>
                            <div class="col-date">{{ formatDate(order.date) }}</div>
                            <div class="col-total">{{ formatCurrency(order.total) }}</div>
                            <div class="col-status">
                                <p-tag [value]="getOrderStatusLabel(order.status)"
                                    [severity]="getOrderStatusSeverity(order.status)"></p-tag>
                            </div>
                        </div>
                    </div>
                </div>
            </p-card>
        </div>

        <!-- Two Column Layout -->
        <div class="two-column-grid">
            <!-- Top Products -->
            <p-card>
                <ng-template pTemplate="header">
                    <div class="section-header">
                        <h2>
                            <i class="pi pi-star-fill"></i>
                            Productos Más Vendidos
                        </h2>
                    </div>
                </ng-template>

                <div class="product-list">
                    <div *ngFor="let product of dashboardState.stats()?.topProducts" class="product-item">
                        <div class="product-info">
                            <h4>{{ product.name }}</h4>
                            <p>{{ product.sales }} ventas</p>
                        </div>
                        <div class="product-revenue">
                            {{ formatCurrency(product.revenue) }}
                        </div>
                    </div>
                </div>
            </p-card>

            <!-- Low Stock Products -->
            <p-card>
                <ng-template pTemplate="header">
                    <div class="section-header">
                        <h2>
                            <i class="pi pi-exclamation-triangle"></i>
                            Productos con Bajo Stock
                        </h2>
                        <p-tag *ngIf="dashboardState.lowStockCount() > 0"
                            [value]="dashboardState.lowStockCount().toString()" severity="warn"></p-tag>
                    </div>
                </ng-template>

                <div class="product-list">
                    <div *ngFor="let product of dashboardState.stats()?.lowStockProducts"
                        class="product-item low-stock">
                        <div class="product-info">
                            <h4>{{ product.name }}</h4>
                            <p>Stock actual: {{ product.stock }} / Mínimo: {{ product.minStock }}</p>
                        </div>
                        <div class="stock-indicator">
                            <p-tag value="Bajo Stock" severity="warn"></p-tag>
                        </div>
                    </div>

                    <div *ngIf="dashboardState.lowStockCount() === 0" class="empty-state">
                        <i class="pi pi-check-circle"></i>
                        <p>Todos los productos tienen stock suficiente</p>
                    </div>
                </div>
            </p-card>
        </div>
    </div>
</div>